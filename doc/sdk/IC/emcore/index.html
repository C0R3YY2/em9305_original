<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EM-Core &mdash; EM9305 4.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=665bc78d" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=0cd558ae"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Firmware Update" href="../../sections/FirmwareUpdate.html" />
    <link rel="prev" title="Bluetooth" href="../../sections/Bluetooth.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/logo_h_small.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../ReleaseNotes.html">emb Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sections/GettingStarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sections/MigrationGuide.html">Migration guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sections/IDEIntegration.html">MetaWare IDE Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sections/CMakeBuild.html">CMake and build procedure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sections/rom.html">ROM Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sections/Bluetooth.html">Bluetooth</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">EM-Core</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#supported-hci-commands">Supported HCI commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="#em-core-built-in-libraries">EM-Core Built-in Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-an-application-for-em-core">Building an application for EM-Core</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#list-of-em-core-variants">List of EM-Core Variants</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#custom-em-core">Custom EM-Core</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#building-the-custom-em-core-flavor-distributed-in-the-sdk">Building the custom <em>EM-Core</em> flavor distributed in the SDK</a></li>
<li class="toctree-l3"><a class="reference internal" href="#defining-a-custom-flavor">Defining a custom flavor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tweaking-the-cmake-file">Tweaking the <code class="docutils literal notranslate"><span class="pre">.cmake</span></code> file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-a-missing-library">Adding a missing library</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-the-em-core-custom-flavor">Building the <em>EM-Core</em> custom flavor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-the-application-and-linking-with-user-em-core">Building the application and linking with user <em>EM-Core</em></a></li>
<li class="toctree-l3"><a class="reference internal" href="#change-log">Change Log</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#version-4-1-0">Version 4.1.0</a></li>
<li class="toctree-l4"><a class="reference internal" href="#version-4-0-0">Version 4.0.0</a></li>
<li class="toctree-l4"><a class="reference internal" href="#version-3-5-0">Version 3.5.0</a></li>
<li class="toctree-l4"><a class="reference internal" href="#version-3-4-0">Version 3.4.0</a></li>
<li class="toctree-l4"><a class="reference internal" href="#version-3-3-0">Version 3.3.0</a></li>
<li class="toctree-l4"><a class="reference internal" href="#version-3-1-0">Version 3.1.0</a></li>
<li class="toctree-l4"><a class="reference internal" href="#version-2-6-0">Version 2.6.0</a></li>
<li class="toctree-l4"><a class="reference internal" href="#version-1-0-0">Version 1.0.0</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../sections/FirmwareUpdate.html">Firmware Update</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sections/Lifecycle.html">EM9305 Lifecycle Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Examples.html">Sample Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sections/Links.html">Links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sections/ApplicationNotes.html">Application Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sections/HowTo.html">How to</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sections/FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sections/Limitations.html">Known limitations &amp; constraints</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: white" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">EM9305</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">EM-Core</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="em-core">
<span id="emcore"></span><h1>EM-Core<a class="headerlink" href="#em-core" title="Link to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>The <em>EM-Core</em> package provides a lightweight standalone and autonomous application
as well as a set of functions that can be directly used as support functions by the end user application.
The symbols file that contains the name of the available functions is provided with the SDK. It contains the
list of the functions available in the “standard” EM-Core and that can be used within the end user application.</p>
<p>The <em>EM-Core</em> application is a standalone application that reside in NVM.</p>
<p>The following figure shows where the <em>EM-Core</em> standalone application firmware image sits in the NVM.</p>
<a class="reference internal image-reference" href="../../_images/NVM_content_EMCore_based_app.png"><img alt="The NVM memory content" class="align-center" src="../../_images/NVM_content_EMCore_based_app.png" style="width: 262.0px; height: 474.0px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The <em>EM-Core</em> image is stored at the beginning of the second memory page at address <code class="docutils literal notranslate"><span class="pre">0x30_2000</span></code> which is its default location. However, it can be stored at any other location provided the fact that its first address shall be bounded to the beginning of the page where it is stored.
Further in memory, the end user application software is stored and in case firmware update process is needed, then the firmware update application is stored usually at the end of the memory.</p>
<p>To have the device being able to start-up, the bare minimum is to have:</p>
<blockquote>
<div><ul class="simple">
<li><p>NVM_bootloader</p></li>
<li><p>EM-Core</p></li>
</ul>
</div></blockquote>
<p>With this configuration, the device can be started in the “<em>EM-Core</em>” mode.
However, this <em>EM-Core</em> package is not mandatory and can be skipped if the application software is present. In such a case, the end user
application will be started. However, both the <em>EM-Core</em> and the end user application can share
the same NVM space in case the application relies on a set of functions provided by <em>EM-Core</em>.
In this case, the default behavior is to start executing the end user application. But the <em>EM-Core</em>
standalone application can still be executed on demand.</p>
<p>Beyond the available standard <em>EM-Core</em> that is provided within the SDK, the user has the possibility
to build his/her own homebrewed <em>EM-Core</em> that would serve as a foundation for the application. More
details are provided further in this page on how to build and to use a custom <em>EM-Core</em>.</p>
<p>In case the end user application is not programmed yet in the device, it is still possible to start-up
the <em>EM-Core</em> standalone application.</p>
</section>
<section id="supported-hci-commands">
<h2>Supported HCI commands<a class="headerlink" href="#supported-hci-commands" title="Link to this heading"></a></h2>
<p>In order to communicate with <em>EM-Core</em>, a set of HCI commands is supported. All
these commands are gathered within the so called <code class="docutils literal notranslate"><span class="pre">EMSystem</span></code> (abbreviated <code class="docutils literal notranslate"><span class="pre">EMS</span></code>). This is why each
such commands name starts with this prefix. It is completed by one or two additional letters that give information to which subsystem the command belongs to according to the following scheme:</p>
<blockquote>
<div><ul class="simple">
<li><p>G: General</p></li>
<li><p>S: Security</p></li>
<li><p>RC: Radio Control</p></li>
<li><p>MM: Memory Management</p></li>
</ul>
</div></blockquote>
<p>For example, the command <code class="docutils literal notranslate"><span class="pre">EMSRC_TransmitterTest</span></code> deals with the radio subsystem and actually starts a test procedure of the radio transmitter.</p>
<p>The following table summarizes the list of HCI commands that the <code class="docutils literal notranslate"><span class="pre">EMSystem</span></code> supports.</p>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">Em-Core Command Set</span><a class="headerlink" href="#id1" title="Link to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Command</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>EMSG_CpuReset</p></td>
<td><p>Issue a CPU reset</p></td>
</tr>
<tr class="row-odd"><td><p>EMSG_EnterConfigurationMode</p></td>
<td><p>Reboot in Configuration Mode (ROM)</p></td>
</tr>
<tr class="row-even"><td><p>EMSG_GetEmCoreInformation</p></td>
<td><p>Get EM-Core information (version, variant)</p></td>
</tr>
<tr class="row-odd"><td><p>EMSG_SetBootModeFlags</p></td>
<td><p>Set persistent boot mode selection flags</p></td>
</tr>
<tr class="row-even"><td><p>EMSG_ClearBootModeFlags</p></td>
<td><p>Clear persistent boot mode selection flags</p></td>
</tr>
<tr class="row-odd"><td><p>EMSG_ReadMACAddress</p></td>
<td><p>Read the MAC Address from Info Page</p></td>
</tr>
<tr class="row-even"><td><p>EMSG_ReadProductInformation</p></td>
<td><p>Read the Product Information</p></td>
</tr>
<tr class="row-odd"><td><p>EMSRC_ReceiverTest</p></td>
<td><p>Start receiver test</p></td>
</tr>
<tr class="row-even"><td><p>EMSRC_ReceiverTestEnd</p></td>
<td><p>Terminate receiver test</p></td>
</tr>
<tr class="row-odd"><td><p>EMSRC_TransmitterTest</p></td>
<td><p>Start transmitter test</p></td>
</tr>
<tr class="row-even"><td><p>EMSRC_TransmitterTestEnd</p></td>
<td><p>Terminate transmitter test</p></td>
</tr>
<tr class="row-odd"><td><p>EMSRC_StartAdvPattern</p></td>
<td><p>Start advertising pattern for current measurement in production</p></td>
</tr>
<tr class="row-even"><td><p>EMSS_LeRand</p></td>
<td><p>Request a random number</p></td>
</tr>
<tr class="row-odd"><td><p>EMSS_LeEncrypt</p></td>
<td><p>Encrypt data using AES hardware engine</p></td>
</tr>
<tr class="row-even"><td><p>EMSS_LE_Decrypt</p></td>
<td><p>Decrypt data using AES hardware engine</p></td>
</tr>
<tr class="row-odd"><td><p>EMSS_LE_Encrypt_KC</p></td>
<td><p>Encrypt data using AES hardware engine with the key container in information page 0</p></td>
</tr>
<tr class="row-even"><td><p>EMSS_LE_Decrypt_KC</p></td>
<td><p>Decrypt data using AES hardware engine with the key container in information page 0</p></td>
</tr>
<tr class="row-odd"><td><p>EMSMM_Read_At_Address</p></td>
<td><p>Read one or more bytes at the given address</p></td>
</tr>
<tr class="row-even"><td><p>EMSMM_Write_At_Address</p></td>
<td><p>Write one or more bytes at the given address</p></td>
</tr>
<tr class="row-odd"><td><p>EMSG_Set_Sleep_Options</p></td>
<td><p>Enable or disable sleep mode</p></td>
</tr>
</tbody>
</table>
<p>Sending these commands can be done on a host computer connected to the device (the DVK) and running the <em>BLEngine</em> tool.</p>
<p>For example, to trigger a CPU reset, the following command shall be issued:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python<span class="w"> </span>blengine_cli.py<span class="w"> </span>send<span class="w"> </span>EMSG_CPU_RESET
</pre></div>
</div>
<p>When the end user application is running and there is a need to start the <em>EM-Core</em> standalone application, the following procedure can be issued:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python<span class="w"> </span>blengine_cli.py<span class="w"> </span>run<span class="w"> </span>restart<span class="w"> </span>--mode<span class="o">=</span>emcore
</pre></div>
</div>
<p>It will end-up in running the <em>EM-Core</em> standalone application.</p>
<p>To get more details on the execution of this command, the option <code class="docutils literal notranslate"><span class="pre">--debug</span></code> can be added:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python<span class="w"> </span>blengine_cli.py<span class="w"> </span>--debug<span class="w"> </span>run<span class="w"> </span>restart<span class="w"> </span>--mode<span class="o">=</span>emcore
</pre></div>
</div>
</section>
<section id="em-core-built-in-libraries">
<h2>EM-Core Built-in Libraries<a class="headerlink" href="#em-core-built-in-libraries" title="Link to this heading"></a></h2>
<p>The default standard <em>EM-Core</em> includes the following libraries:</p>
<table class="docutils align-default" id="id2">
<caption><span class="caption-text">EM-Core built-in libraries</span><a class="headerlink" href="#id2" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 37.5%" />
<col style="width: 62.5%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Command</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Metaware</p></td>
<td><p>Metaware libraries</p></td>
</tr>
<tr class="row-odd"><td><p>em_core</p></td>
<td><p>EM-Core standalone Application</p></td>
</tr>
<tr class="row-even"><td><p>em_hw_api</p></td>
<td><p>Hardware support for EM930x family of SOC</p></td>
</tr>
<tr class="row-odd"><td><p>em_system_emcore</p></td>
<td><p>EM System support for EM-Core (set of EM System Commands)</p></td>
</tr>
<tr class="row-even"><td><p>header_access</p></td>
<td><p>Functions to get access to firmware image headers</p></td>
</tr>
<tr class="row-odd"><td><p>nvm_entry_emcore</p></td>
<td><p>Entry function in NVM and boot selection</p></td>
</tr>
<tr class="row-even"><td><p>pml</p></td>
<td><p>Power Management logic</p></td>
</tr>
<tr class="row-odd"><td><p>radio</p></td>
<td><p>Radio driver</p></td>
</tr>
<tr class="row-even"><td><p>prot_timer</p></td>
<td><p>Protocol Timer</p></td>
</tr>
<tr class="row-odd"><td><p>sleep_timer</p></td>
<td><p>Sleep Timer</p></td>
</tr>
<tr class="row-even"><td><p>rc_calib</p></td>
<td><p>RC Calibration library</p></td>
</tr>
<tr class="row-odd"><td><p>sleep_manager</p></td>
<td><p>Sleep manager</p></td>
</tr>
<tr class="row-even"><td><p>transport</p></td>
<td><p>Transport manager</p></td>
</tr>
<tr class="row-odd"><td><p>QPC</p></td>
<td><p>QPC Library</p></td>
</tr>
</tbody>
</table>
</section>
<section id="building-an-application-for-em-core">
<h2>Building an application for EM-Core<a class="headerlink" href="#building-an-application-for-em-core" title="Link to this heading"></a></h2>
<p>In order to build an application using a given version of EM-Core, the CMake macro
<code class="docutils literal notranslate"><span class="pre">GENERATE_EMCORE_APPLICATION()</span></code> shall be used in the application <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file.
See below this page the EM-Core integration part for a comprehensive description of
this macro.</p>
<p>By default, EM-Core based applications are built for the latest EM-Core version available in the SDK.</p>
<p>In order to build an application based on EM-Core, the CMake macro <code class="docutils literal notranslate"><span class="pre">GENERATE_EMCORE_APPLICATION()</span></code> shall be used.
It accepts the following parameters:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c"># \param: target -&gt; this is the name of the executable target.</span>
<span class="c"># \param: emcore -&gt; must be one of EMCORE_VARIANT with optional version E.g., &quot;standard;v1.0.0&quot;</span>
<span class="c"># \param: source_files -&gt; list of source files to be compiled</span>
<span class="c"># \param: include_files -&gt; list of header files to be included</span>
<span class="c"># \param: flags -&gt; list of compile flags to be added. Use &quot;&quot; for no flags.</span>
<span class="c"># \param(optional): libs -&gt; list of libraries to be linked to the application.</span>
<span class="c"># should not be one of &#39;EMCORE_LIBS_*&#39;</span>
<span class="c">#</span>
<span class="c"># Example:</span>
<span class="c"># GENERATE_EMCORE_APPLICATION(my_target &quot;standard&quot;</span>
<span class="c">#     &quot;${${PROJECT_NAME}_SRCS}&quot; &quot;${${PROJECT_NAME}_INCLUDES}&quot;</span>
<span class="c">#     &quot;${STANDARD_CONFIG}&quot; &quot;my_custom_lib&quot;</span>
<span class="c"># )</span>
</pre></div>
</div>
<p>The code snippet below shows an example on how to trigger the generation of an application that uses <em>EM-Core</em>. In this example, the generated executable will be named with <code class="docutils literal notranslate"><span class="pre">&lt;application&gt;_emcore</span></code> with <em>EM-Core</em> as a suffix in the application’s name.</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">SET</span><span class="p">(</span><span class="s">targets_emcore_flavor</span><span class="w"> </span><span class="s2">&quot;standard&quot;</span><span class="p">)</span>
<span class="nb">APP_IN_NVM</span><span class="p">()</span>
<span class="nb">ARC_EXECUTABLE</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="w"> </span><span class="o">${</span><span class="nv">${PROJECT_NAME</span><span class="o">}</span><span class="s">_SRCS}</span><span class="p">)</span>
<span class="nb">ARC_LINK_LIBRARIES</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="w"> </span><span class="o">${</span><span class="nv">${PROJECT_NAME</span><span class="o">}</span><span class="s">_LIBS}</span><span class="p">)</span>
<span class="nb">ARC_INCLUDE_DIRECTORIES</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="w"> </span><span class="o">${</span><span class="nv">${PROJECT_NAME</span><span class="o">}</span><span class="s">_INCLUDES}</span><span class="p">)</span>
<span class="nb">GENERATE_EMCORE_APPLICATION</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="s">_emcore</span><span class="w"> </span><span class="s2">&quot;${targets_emcore_flavor}&quot;</span>
<span class="w">   </span><span class="s2">&quot;${${PROJECT_NAME}_SRCS}&quot;</span><span class="w"> </span><span class="s2">&quot;${${PROJECT_NAME}_INCLUDES}&quot;</span>
<span class="w">   </span><span class="s2">&quot;-DNO_FLINT_ERRORS&quot;</span>
<span class="w">   </span><span class="s2">&quot;${${PROJECT_NAME}_EMCORE_LIBS}&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The macro instructs the build system to create an <em>EM-Core</em> based application and the final executable’s name will contain the suffix <em>_emcore</em>.</p>
<p>For backward compatibility, it is possible to build an application for an older version of EM-Core.
This can be done by setting the Em-Core version as an optional parameter in the Variant configutration in <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>.</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c">### Setting the variant and the version of EM-Core.</span>
<span class="c">### available &#39;desired_variant&#39; can be found under emcore/bin</span>
<span class="nb">SET</span><span class="p">(</span><span class="s">target_emcore_variant</span><span class="w"> </span><span class="s2">&quot;&lt;desired_variant&gt;;vX.X.X&quot;</span><span class="p">)</span>
<span class="c">### Using EMCORE</span>
<span class="nb">GENERATE_EMCORE_APPLICATION</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="s">_spi_emcore</span><span class="w"> </span><span class="s2">&quot;${target_emcore_variant}&quot;</span>
<span class="w">   </span><span class="s2">&quot;${${PROJECT_NAME}_SRCS}&quot;</span><span class="w"> </span><span class="s2">&quot;${${PROJECT_NAME}_INCLUDES}&quot;</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<section id="list-of-em-core-variants">
<h3>List of EM-Core Variants<a class="headerlink" href="#list-of-em-core-variants" title="Link to this heading"></a></h3>
<p>This SDK provides a standard EM-Core configuration with the above listed built-in libraries.</p>
<table class="docutils align-default" id="id3">
<caption><span class="caption-text">EM-Core Variant</span><a class="headerlink" href="#id3" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 37.5%" />
<col style="width: 62.5%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Command</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>standard</p></td>
<td><p>Standard Version of EM-Core</p></td>
</tr>
</tbody>
</table>
<p>Each <em>EM-Core</em> variant comes with an additional target which name contains the suffix <cite>_no_crc_check</cite> (e.g. <cite>emcore_standard_no_crc_check.ihex</cite>). Such variant includes the exact same functionalities than the variant without this suffix provides except that the image integrity (CRC check) is not verified at power on reset.</p>
<p>Depending on the lifecycle and production flow, CRC may be verified by other means. Therefore, this functionality may save boot time and energy in some specific contexts.</p>
</section>
</section>
<section id="custom-em-core">
<h2>Custom EM-Core<a class="headerlink" href="#custom-em-core" title="Link to this heading"></a></h2>
<p>Instead of using the provided default <em>EM-Core</em>, the end user has the possibility to build his/her own homebrewed <em>EM-Core</em> by adding new custom items or by removing uneeded items. This customized flavor can then be linked against the end user application to create the final application that relies onto this custom <em>EM-Core</em>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In case a customized <em>EM-Core</em> is created and used, it shall be programmed in the NVM along with the end user application that makes use of it. Even if the both the custom <em>EM-Core</em> flavor and the standard one have the same
source code, a standard <em>EM-Core</em> must not be mixed with a sample application designed to run with the custom flavor,
and inversely. In such a case of mixed configuration, the sample application might not be able to start.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The following picture shows the custom <em>EM-Core</em> folder in the SDK.</p>
<a class="reference internal image-reference" href="../../_images/EM-Core_custom_folder_content.png"><img alt="../../_images/EM-Core_custom_folder_content.png" class="align-center" src="../../_images/EM-Core_custom_folder_content.png" style="width: 1011.0px; height: 132.0px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The source code and all build configuration files are provided in the <code class="docutils literal notranslate"><span class="pre">emcore/custom</span></code> folder. The <code class="docutils literal notranslate"><span class="pre">emcore/bin</span></code> folder contains the standard default binary version provided in the SDK along with the <code class="docutils literal notranslate"><span class="pre">NVM_Bootloader</span></code>.</p>
<p>The <em>EM-Core</em> source code is located in both the <code class="docutils literal notranslate"><span class="pre">emcore/custom/includes</span></code> and in <code class="docutils literal notranslate"><span class="pre">emcore/custom/source</span></code> folders.
It corresponds to the standard default <em>EM-Core</em>.</p>
<section id="building-the-custom-em-core-flavor-distributed-in-the-sdk">
<h3>Building the custom <em>EM-Core</em> flavor distributed in the SDK<a class="headerlink" href="#building-the-custom-em-core-flavor-distributed-in-the-sdk" title="Link to this heading"></a></h3>
<p>To showcase how to build a custom <em>EM-Core</em> flavor, a custom version of <em>EM-Core</em> is provided within the SDK. Its name is <em>my_flavor</em>.</p>
<p>First run the command to create the build environment within the SDK:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>&lt;sdk&gt;
$<span class="w"> </span>./init.bat
</pre></div>
</div>
<p>Then build this <em>EM-Core</em> flavor named <code class="docutils literal notranslate"><span class="pre">my_flavor</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
$<span class="w"> </span>cmake<span class="w"> </span>--build<span class="w"> </span>.<span class="w"> </span>--target<span class="w"> </span>emcore_custom_my_flavor
</pre></div>
</div>
<p>After build, all files are installed within the following folder:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;sdk&gt;/emcore/bin/v4.1/my_flavor
</pre></div>
</div>
</section>
<section id="defining-a-custom-flavor">
<h3>Defining a custom flavor<a class="headerlink" href="#defining-a-custom-flavor" title="Link to this heading"></a></h3>
<p>Beyond using the <em>EM-Core</em> flavor provided in the SDK, the user has the possibility to create his own version of <em>EM-Core</em>. The following steps show how this can be done.</p>
<p>The file <code class="docutils literal notranslate"><span class="pre">emcore/custom/custom_emcore_def.cmake</span></code> is where the name of the user flavor’s name is defined.</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">SET</span><span class="p">(</span><span class="s">CUSTOM_EMCORE_FLAVORS</span><span class="w"> </span><span class="s">my_flavor:15</span><span class="p">)</span>
</pre></div>
</div>
<p>The name “<em>my_flavor</em>”” shall be replaced by any name relevant to the user defined configuration, with the exception to the “<em>standard</em>” name.</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">SET</span><span class="p">(</span><span class="s">CUSTOM_EMCORE_FLAVORS</span><span class="w"> </span><span class="s">custom_flavor:1234</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="tweaking-the-cmake-file">
<h3>Tweaking the <code class="docutils literal notranslate"><span class="pre">.cmake</span></code> file<a class="headerlink" href="#tweaking-the-cmake-file" title="Link to this heading"></a></h3>
<p>The file <code class="docutils literal notranslate"><span class="pre">emcore/custom/custom_emcore.cmake</span></code> is the actual file that will be processed by <code class="docutils literal notranslate"><span class="pre">CMake</span></code> to create the custom <em>EM-Core</em>. This is also the place where the user can list his/her own source files and/or libraries.
Generally speaking, the user will tweak the content of this file to customize his/her own <em>EM-Core</em> flavor. This requires having a quite good knowledge of <code class="docutils literal notranslate"><span class="pre">CMake</span></code> files syntax, but nothing fancy here.</p>
<p>Any reference to the “<em>my_flavor</em>” pattern shall be changed to match with the user defined flavor’s name.</p>
<p>Let’s consider a new ‘<em>custom_flavor</em>’ version. The following statements shall be changed in the file.</p>
<p>First, set the name of the custom <em>EM-Core</em> library. This will define the name of the output file for this specific <em>EM-Core</em> in the <code class="docutils literal notranslate"><span class="pre">&lt;sdk&gt;/build/emcore/custom</span></code> folder.</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">SET</span><span class="p">(</span><span class="s">CUSTOM_EMCORE_LIBS</span>
<span class="w">   </span><span class="s">emcore_information_custom_flavor</span>
<span class="w">   </span><span class="c"># Add the libraries you want to include to your custom EM-Core</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Then, change the name of the variable that contains the list of header files to include:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">SET</span><span class="p">(</span><span class="s">CUSTOM_EMCORE_INCLUDES__custom_flavor</span>
<span class="w">   </span><span class="o">${</span><span class="nv">CUSTOM_EMCORE_INCLUDES_COMMON</span><span class="o">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Then, the variable that lists the libraries to link against shall also have its name changed for this flavor:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">SET</span><span class="p">(</span><span class="s">CUSTOM_EMCORE_LIBS__custom_flavor</span>
<span class="w">   </span><span class="o">${</span><span class="nv">CUSTOM_EMCORE_LIBS_COMMON</span><span class="o">}</span>
<span class="w">   </span><span class="o">${</span><span class="nv">CUSTOM_EMCORE_LIBS</span><span class="o">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Note that for all these modifications, only the suffix is changed:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">_my_flavor</span></code> ==&gt; <code class="docutils literal notranslate"><span class="pre">_custom_flavor</span></code></p>
</div></blockquote>
</section>
<section id="adding-a-missing-library">
<h3>Adding a missing library<a class="headerlink" href="#adding-a-missing-library" title="Link to this heading"></a></h3>
<p>Whenever the standard <em>EM-Core</em> does not contain a library that is needed, it can be easily added.</p>
<p>Let’s take the <cite>unitimer</cite> example to be added in a custom flavor of <em>EM-Core</em>. Still in the <code class="docutils literal notranslate"><span class="pre">custom_emcore.cmake</span></code> file, the include folder where the <code class="docutils literal notranslate"><span class="pre">unitimer</span></code> header file is located is introduced by adding it to the <code class="docutils literal notranslate"><span class="pre">CUSTOM_EMCORE_INCLUDES__custom_flavor</span></code> variable:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">SET</span><span class="p">(</span><span class="s">CUSTOM_EMCORE_INCLUDES__custom_flavor</span>
<span class="w">  </span><span class="o">${</span><span class="nv">CUSTOM_EMCORE_INCLUDES_COMMON</span><span class="o">}</span>
<span class="w">  </span><span class="o">${</span><span class="nv">LIBS_DIR</span><span class="o">}</span><span class="s">/unitimer/includes</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This statement is mandatory to get access to the <code class="docutils literal notranslate"><span class="pre">unitimer</span></code> header file.</p>
<p>Then, to successfully link the <em>EM-Core</em> with this library, the following statement shall be added in the variable <code class="docutils literal notranslate"><span class="pre">CUSTOM_EMCORE_LIBS__custom_flavor</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">SET</span><span class="p">(</span><span class="s">CUSTOM_EMCORE_LIBS__custom_flavor</span>
<span class="w">  </span><span class="o">${</span><span class="nv">CUSTOM_EMCORE_LIBS_COMMON</span><span class="o">}</span>
<span class="w">  </span><span class="o">${</span><span class="nv">CUSTOM_EMCORE_LIBS</span><span class="o">}</span>
<span class="w">  </span><span class="s">unitimer</span>
<span class="p">)</span>
</pre></div>
</div>
<p>And that’s it. The next step is to build this <em>EM-Core</em> flavor as shown in the next step.</p>
</section>
<section id="building-the-em-core-custom-flavor">
<h3>Building the <em>EM-Core</em> custom flavor<a class="headerlink" href="#building-the-em-core-custom-flavor" title="Link to this heading"></a></h3>
<p>Re-execute the <em>init.bat</em> script to recreate the build environment:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>&lt;sdk&gt;
$<span class="w"> </span>./init.bat
</pre></div>
</div>
<p>Note that this command will erase a previously built <code class="docutils literal notranslate"><span class="pre">build</span></code> folder. This step is mandatory to create the specific user defined <em>EM-Core</em> target so it can be built.</p>
<p>Then, building the <em>EM-Core</em> custom flavor is done by issuing the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
$<span class="w"> </span>cmake<span class="w"> </span>--build<span class="w"> </span>.<span class="w"> </span>--target<span class="w"> </span>custom_emcore_custom_flavor
</pre></div>
</div>
<p>The target name starts with <code class="docutils literal notranslate"><span class="pre">custom_emcore_</span></code> and is followed by the name of the flavor to be built.</p>
</section>
<section id="building-the-application-and-linking-with-user-em-core">
<h3>Building the application and linking with user <em>EM-Core</em><a class="headerlink" href="#building-the-application-and-linking-with-user-em-core" title="Link to this heading"></a></h3>
<p>The last step to complete is to instruct the build system to link with the user defined <em>EM-Core</em> when building an app instead of linking with the standard one.</p>
<p>Let’s take the <code class="docutils literal notranslate"><span class="pre">nvm_emb_hrs</span></code> sample application as an example.</p>
<p>Looking at its <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file, the following lines are where the magic takes place:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">SET</span><span class="p">(</span><span class="s">targets_emcore_flavor</span><span class="w"> </span><span class="s2">&quot;standard&quot;</span><span class="p">)</span>
<span class="nb">APP_IN_NVM</span><span class="p">()</span>
<span class="nb">ARC_EXECUTABLE</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="w"> </span><span class="o">${</span><span class="nv">${PROJECT_NAME</span><span class="o">}</span><span class="s">_SRCS}</span><span class="p">)</span>
<span class="nb">ARC_LINK_LIBRARIES</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="w"> </span><span class="o">${</span><span class="nv">${PROJECT_NAME</span><span class="o">}</span><span class="s">_LIBS}</span><span class="p">)</span>
<span class="nb">ARC_INCLUDE_DIRECTORIES</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="w"> </span><span class="o">${</span><span class="nv">${PROJECT_NAME</span><span class="o">}</span><span class="s">_INCLUDES}</span><span class="p">)</span>
<span class="nb">GENERATE_EMCORE_APPLICATION</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="s">_emcore</span><span class="w"> </span><span class="s2">&quot;${targets_emcore_flavor}&quot;</span>
<span class="w">   </span><span class="s2">&quot;${${PROJECT_NAME}_SRCS}&quot;</span><span class="w"> </span><span class="s2">&quot;${${PROJECT_NAME}_INCLUDES}&quot;</span>
<span class="w">   </span><span class="s2">&quot;-DNO_FLINT_ERRORS&quot;</span>
<span class="w">   </span><span class="s2">&quot;${${PROJECT_NAME}_EMCORE_LIBS}&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>As it can be seen, the variable <code class="docutils literal notranslate"><span class="pre">targets_emcore_flavor</span></code> defines the <em>EM-Core</em> flavor that shall be used. The user defined flavor shall be written here instead of <em>standard</em>.</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">SET</span><span class="p">(</span><span class="s">targets_emcore_flavor</span><span class="w"> </span><span class="s2">&quot;custom_flavor&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Optionally, the first parameter of the <code class="docutils literal notranslate"><span class="pre">GENERATE_EMCORE_APPLICATION</span></code> macro can be change to be more representative of the user define version of the application. Consequently, the suffix <em>_emcore</em> can be changed to something else. But this modification is not mandatory.</p>
<p>Then, the application can be built by issuing the following command in the SDK folder:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
$<span class="w"> </span>cmake<span class="w"> </span>--build<span class="w"> </span>.<span class="w"> </span>--target<span class="w"> </span>nvm_emb_hrs_emcore
</pre></div>
</div>
<p>Note that this command instructs to build the new <em>EM-Core</em> flavor. But the exact version (or name) is specified within the <code class="docutils literal notranslate"><span class="pre">.cmake</span></code> file.</p>
<p>And that’s it!</p>
<p>The generated <em>EM-Core</em> is located in the <code class="docutils literal notranslate"><span class="pre">&lt;sdk&gt;/build/emcore/custom</span></code> and the generated files are shown in the screenshot below:</p>
<a class="reference internal image-reference" href="../../_images/Custom_emcore_generated.png"><img alt="../../_images/Custom_emcore_generated.png" class="align-center" src="../../_images/Custom_emcore_generated.png" style="width: 569.0px; height: 287.0px;" /></a>
<p>In particular, the file <code class="docutils literal notranslate"><span class="pre">custom_emcore_custom_flavor_di05.ihex</span></code> is the one that shall be programmed in the NVM.</p>
<p>And the <code class="docutils literal notranslate"><span class="pre">nvm_emb_hrs_emcore</span></code> application that uses this custom flavor has been built in <code class="docutils literal notranslate"><span class="pre">&lt;sdk&gt;/build/projects/nvm_emb_hrs</span></code> as shown in the following screenshot:</p>
<a class="reference internal image-reference" href="../../_images/nvm_emb_hrs_emcore_generated.png"><img alt="../../_images/nvm_emb_hrs_emcore_generated.png" class="align-center" src="../../_images/nvm_emb_hrs_emcore_generated.png" style="width: 564.0px; height: 223.0px;" /></a>
<p>Same as above, the <code class="docutils literal notranslate"><span class="pre">.ihex</span></code> file is the one to use to program in the NVM.</p>
</section>
<section id="change-log">
<h3>Change Log<a class="headerlink" href="#change-log" title="Link to this heading"></a></h3>
<section id="version-4-1-0">
<h4>Version 4.1.0<a class="headerlink" href="#version-4-1-0" title="Link to this heading"></a></h4>
<blockquote>
<div><ul class="simple">
<li><p>Integrate EM HW API driver v1.0.0</p></li>
<li><p>Integrate Radio driver v0.9.0</p></li>
<li><p>Integrate NVM driver v0.3.1</p></li>
</ul>
</div></blockquote>
</section>
<section id="version-4-0-0">
<h4>Version 4.0.0<a class="headerlink" href="#version-4-0-0" title="Link to this heading"></a></h4>
<blockquote>
<div><ul class="simple">
<li><p>Integrate Radio driver version 0.8.0</p></li>
<li><p>Integrate PML driver version 0.6.0</p></li>
<li><p>EM-Core versioning is aligned with SDK version</p></li>
</ul>
</div></blockquote>
</section>
<section id="version-3-5-0">
<h4>Version 3.5.0<a class="headerlink" href="#version-3-5-0" title="Link to this heading"></a></h4>
<blockquote>
<div><ul class="simple">
<li><p>Ensure EMSRC_ReceiverTestEnd sends the correct information when the receiver test has not been initiated.</p></li>
<li><p>Integrate em_hw_api driver version 0.2.0</p></li>
<li><p>Integrate QPC driver version 0.2.0</p></li>
<li><p>Integrate PML driver version 0.6.0</p></li>
<li><p>Integrate Radio driver version 0.7</p></li>
</ul>
</div></blockquote>
</section>
<section id="version-3-4-0">
<h4>Version 3.4.0<a class="headerlink" href="#version-3-4-0" title="Link to this heading"></a></h4>
<blockquote>
<div><ul class="simple">
<li><p>PR6458 - Enable division by zero exception durig wakeup and power on reset (POR).</p></li>
</ul>
</div></blockquote>
</section>
<section id="version-3-3-0">
<h4>Version 3.3.0<a class="headerlink" href="#version-3-3-0" title="Link to this heading"></a></h4>
<blockquote>
<div><ul class="simple">
<li><p>Radio transmitter control improvement for power consumption optimization</p></li>
<li><p>Power consumption improvement (Tx pulse)</p></li>
<li><p>CTE functions moved to AoA / AoD library for direction finding</p></li>
<li><p>Set Rx Max PDU length (BLE Audio fix for BIS)</p></li>
</ul>
</div></blockquote>
</section>
<section id="version-3-1-0">
<h4>Version 3.1.0<a class="headerlink" href="#version-3-1-0" title="Link to this heading"></a></h4>
<blockquote>
<div><ul class="simple">
<li><p>Add support for di05</p></li>
<li><p>Improve the previous fix regarding STATUS content when task switching in QP/C by setting or retaining only required bits U, DZ, SC, AD and US according to compilation definitions.</p></li>
<li><p>Radio:</p>
<ul>
<li><p>Fix +8 and +10 dBm RF Output Power</p></li>
</ul>
</li>
</ul>
</div></blockquote>
</section>
<section id="version-2-6-0">
<h4>Version 2.6.0<a class="headerlink" href="#version-2-6-0" title="Link to this heading"></a></h4>
<blockquote>
<div><ul class="simple">
<li><p>Bug fix in Transmitter Test command</p>
<ul>
<li><p>Return an error when packet length overtake the maximum allowed size for test packets in DTM mode only.</p></li>
</ul>
</li>
<li><p>Improvement of Transmitter and Receiver Tests:</p>
<ul>
<li><p>Add parameter check for the lower boundaries</p></li>
<li><p>Radio driver initialization done only once during EM-Core initialization</p></li>
</ul>
</li>
<li><p>Restoring full STATUS content when task switching in QP/C. With this new version, all the bits keep their former values during task switching under QP/C control.</p></li>
<li><p>PML Driver: Adjust the SCDB Mode Multiplier to double when the supply goes from 1.5 to 1.1v to avoid Brownout reset.</p></li>
<li><p>Fix RSSI value computation in Direct Test Mode (DTM)</p></li>
<li><p>DI04 support added</p></li>
<li><p>Introduction of the standard version of EM-Core</p></li>
<li><p>Enabling pull-down configuration on GPIO6 &amp; GPIO7</p></li>
<li><p>Fix packet error rate (PER) problem in EM-Core Radio test RX command.</p></li>
<li><p>Improvement of Radio configuration robustness with respect to HF-XTAL switching</p></li>
<li><p>Fix a power consumption issue in Step Down power mode</p></li>
<li><p>EM-Core includes new test commands used at wafer level.</p>
<ul>
<li><p>EMSS_LE_Decrypt, EMSS_LE_Decrypt_KC and EMSS_Encrypt_KC (Key Container).</p></li>
<li><p>EMSMM_Read_At_Address and EMSMM_Write_At_Address available in EM-Core for production purpose.</p></li>
<li><p>EMSG_Set_Sleep_Options command available in EM-Core for production purpose.</p></li>
</ul>
</li>
<li><p>EM-Core Radio Test commands have also been updated to improve wafer test sequence.</p>
<ul>
<li><p>EMSRC_Start_ADV_Pattern starts advertising immediately after the command is received.</p></li>
</ul>
</li>
<li><p>EM-Core is available in legacy form and also with the no_crc_check option.</p></li>
</ul>
</div></blockquote>
</section>
<section id="version-1-0-0">
<h4>Version 1.0.0<a class="headerlink" href="#version-1-0-0" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Initial Version</p></li>
</ul>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../sections/Bluetooth.html" class="btn btn-neutral float-left" title="Bluetooth" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../sections/FirmwareUpdate.html" class="btn btn-neutral float-right" title="Firmware Update" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023-2024, EM Microelectronic.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>