<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>How to &mdash; EM9305 4.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=665bc78d" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=0cd558ae"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Frequently Asked Questions" href="FAQ.html" />
    <link rel="prev" title="Application Notes" href="ApplicationNotes.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >

          
          
          <a href="../index.html">
            
              <img src="../_static/logo_h_small.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../ReleaseNotes.html">emb Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="GettingStarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="MigrationGuide.html">Migration guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="IDEIntegration.html">MetaWare IDE Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="CMakeBuild.html">CMake and build procedure</a></li>
<li class="toctree-l1"><a class="reference internal" href="rom.html">ROM Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="Bluetooth.html">Bluetooth</a></li>
<li class="toctree-l1"><a class="reference internal" href="../IC/emcore/index.html">EM-Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="FirmwareUpdate.html">Firmware Update</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lifecycle.html">EM9305 Lifecycle Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../IC/API.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../IC/Examples.html">Sample Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="Links.html">Links</a></li>
<li class="toctree-l1"><a class="reference internal" href="ApplicationNotes.html">Application Notes</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">How to</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#measure-the-current-consumption-on-the-dvk">Measure the current consumption on the DVK</a></li>
<li class="toctree-l2"><a class="reference internal" href="#read-write-the-nvm-information-area">Read/Write the NVM information area</a></li>
<li class="toctree-l2"><a class="reference internal" href="#lock-information-pages">Lock information pages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#json-file-configuration">JSON file configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#modifying-lock-bits">Modifying lock bits</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Limitations.html">Known limitations &amp; constraints</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: white" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">EM9305</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">How to</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="how-to">
<h1>How to<a class="headerlink" href="#how-to" title="Link to this heading"></a></h1>
<section id="measure-the-current-consumption-on-the-dvk">
<h2>Measure the current consumption on the DVK<a class="headerlink" href="#measure-the-current-consumption-on-the-dvk" title="Link to this heading"></a></h2>
<p>To measure the current consumption on the DVK, 2 python scripts are provided.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The measure is not precise but can be used to determine if the EM9305 is going to sleep correctly for example.</p>
</div>
<p>The scripts are available in <strong>tools/blengine</strong>.</p>
<ul class="simple">
<li><p><strong>dvk_current_calibration.py</strong> is used for calibration. It will measure an offset to add to the current measurement.</p></li>
<li><p><strong>dvk_current_measure.py</strong> will measure the current. The measure is done on 20ms 10 times (10 measures in the script).</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>tools/blengine
python<span class="w"> </span>dvk_current_calibration.py<span class="w"> </span>--port<span class="o">=</span>COMYY
python<span class="w"> </span>dvk_current_measure.py<span class="w"> </span>--port<span class="o">=</span>COMYY
</pre></div>
</div>
<p>With YY = the COM port number of your DVK.</p>
</section>
<section id="read-write-the-nvm-information-area">
<h2>Read/Write the NVM information area<a class="headerlink" href="#read-write-the-nvm-information-area" title="Link to this heading"></a></h2>
<p>To read and write the NVM information area, BLEngine tool can be used.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It’s recommended to be in <strong>Configuration Mode</strong> to read/write the memory.</p>
<p>The device shall be unlocked to be able to read/write the memory.
It is automatically the case unless the <strong>Authentication Required Flag</strong> is set in the NVM information area.</p>
</div>
<p>BLEngine allows to perform the following actions:</p>
<ol class="arabic simple">
<li><p><strong>erase</strong>: Erase a NVM information page.</p></li>
<li><p><strong>read</strong>: Read the content of a NVM information page.</p></li>
<li><p><strong>write</strong>: Write the content of a NVM configuration page (erase is automatically performed first).</p></li>
</ol>
<p>Arguments:</p>
<ul class="simple">
<li><p><strong>--page {em,user}</strong> or <strong>-p {em,user}</strong>: NVM information page selection, default: <strong>em</strong></p></li>
<li><p><strong>-in &lt;file&gt;</strong>: output file for read action, input file for write action</p></li>
</ul>
<p>Usage:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>blengine_cli.py<span class="w"> </span>--port<span class="w"> </span>COMYY<span class="w"> </span>run<span class="w"> </span>nvm_erase<span class="w"> </span>-p<span class="w"> </span>user
python<span class="w"> </span>blengine_cli.py<span class="w"> </span>--port<span class="w"> </span>COMYY<span class="w"> </span>run<span class="w"> </span>nvm_read<span class="w"> </span>-p<span class="w"> </span>user<span class="w"> </span>-out<span class="w"> </span>config.json
python<span class="w"> </span>blengine_cli.py<span class="w"> </span>--port<span class="w"> </span>COMYY<span class="w"> </span>run<span class="w"> </span>nvm_write<span class="w"> </span>-p<span class="w"> </span>user<span class="w"> </span>-in<span class="w"> </span>config.json
</pre></div>
</div>
<p>With YY = the COM port number of your DVK.</p>
<p>Input and output files are in JSON format.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A good practice is to do <strong>read-modify-write operation</strong>.
By doing the read operation, you get a JSON template that you can fill with the new configuration.
Then, you can write this new configuration in the NVM information area.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The NVM information <strong>em</strong> page contains some device specific information that should not be erased or overwritten!
It’s recommended to update only the <strong>user</strong> page.</p>
</div>
</section>
<section id="lock-information-pages">
<h2>Lock information pages<a class="headerlink" href="#lock-information-pages" title="Link to this heading"></a></h2>
<section id="overview">
<h3>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h3>
<p>The information pages can be permanently locked by setting the appropriate bits
in the right place in the flash memory.
At startup during the ROM boot sequence, these bits are read and used to configure
the device. Once configured, an information page is protected against erase, and
then consequently against rewrite.</p>
<p>This documentation page explains how to configure the information pages lock bits.</p>
</section>
<section id="json-file-configuration">
<h3>JSON file configuration<a class="headerlink" href="#json-file-configuration" title="Link to this heading"></a></h3>
<p>The lock bits for the information pages are stored in information page 3 and are
duplicated in information page 2.</p>
<p>The lock bits in information page 3 are used to lock some NVM parts like typically
the information page 3 which contains configuration values that must not be changed
in order to have the device work properly.
These lock bits let other information pages opened for the customer to store its
own configuration parameters and to freely decide which of the non locked page he
wants to lock.</p>
<p>So, usually the customer receives devices with information page 3 locked. Since
it is not possible for the customer to complete the locking information in information
page 3 (because it is locked), then he has the possibility to use the same data
structure but in information page 2 which is not locked.</p>
<p>Note that once a page is locked, it cannot be unlocked. So if information page 3
(reserved for EM usage) is locked while information page 2 is unlocked, the
customer might want to enforce value 0 for information page 3 lock bit in its
own reserved page. However, such action will have no effect and the information
page 3 will stay locked anyway.</p>
<p>The previous chapter above shows how to read the content of either the information
page 3 or the information page 2. The outcome of such read is a JSON file which
contains all the fields in a human readable format.</p>
<p>The following screenshot is an extract showing the part of the file that contains
the locking information.</p>
<div class="line-block">
<div class="line">“Lock Bits”: {</div>
<div class="line-block">
<div class="line">“address”: “0x1D00”,</div>
<div class="line">“type”: “registers”,</div>
<div class="line">“force”: true,</div>
<div class="line">“data”: {</div>
<div class="line-block">
<div class="line">“RegNvmLockMain0”: {</div>
<div class="line-block">
<div class="line">“RegNvmLockMain0”: null</div>
</div>
<div class="line">},</div>
<div class="line">“RegNvmLockMain1”: {</div>
<div class="line-block">
<div class="line">“RegNvmLockMain1”: null</div>
</div>
<div class="line">},</div>
<div class="line">“RegNvmLockInfo”: {</div>
<div class="line-block">
<div class="line">“NvmEraseLockInfoPage0”: null,</div>
<div class="line">“NvmWriteLockInfoPage0”: null,</div>
<div class="line">“NvmLockInfoPage”: null</div>
</div>
<div class="line">},</div>
</div>
</div>
</div>
</section>
<section id="modifying-lock-bits">
<h3>Modifying lock bits<a class="headerlink" href="#modifying-lock-bits" title="Link to this heading"></a></h3>
<p>From the snippet above, there is the field “RegNvmLockInfo” that defines the
information pages lock structure.
Within this field, the “NvmLockInfoPage” introduces the bits that are used to
define the locking configuration.
This field contains 4 bits, each bit being dedicated to one information page:</p>
<ul class="simple">
<li><p>bit 3 ==&gt; information page 3 <em>(0: unlocked, 1: locked)</em></p></li>
<li><p>bit 2 ==&gt; information page 2 …</p></li>
<li><p>bit 1 ==&gt; information page 1 …</p></li>
<li><p>bit 0 ==&gt; information page 0 …</p></li>
</ul>
<p>Of course, a combination of those bits can be set to lock more than one page in
one single operation.</p>
<p>For example, the decimal value 13 (<em>b1101</em>) will permanently lock information pages 3, 2 and 0.</p>
<p>The modification has to be done manually by editing the JSON file using a simple
text editor:</p>
<div class="line-block">
<div class="line">…</div>
<div class="line-block">
<div class="line">“RegNvmLockInfo”: {</div>
<div class="line-block">
<div class="line">“NvmEraseLockInfoPage0”: null,</div>
<div class="line">“NvmWriteLockInfoPage0”: null,</div>
<div class="line">“NvmLockInfoPage”: <strong>13</strong></div>
</div>
<div class="line">},</div>
</div>
<div class="line">…</div>
</div>
<p>Then using the BLEngine tool, this file is then used to update the content
of information page 3 or 2.</p>
<p>For example, the following command line will write data from the <em>user_config.json</em>
file into the user information page in flash memory (page 2):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>blengine_cli.py<span class="w"> </span>--port<span class="w"> </span>COMYY<span class="w"> </span>run<span class="w"> </span>nvm_write<span class="w"> </span>-p<span class="w"> </span>user<span class="w"> </span>-in<span class="w"> </span>config.json
</pre></div>
</div>
<p>Now you know how to read an information page, how to modify it and how to store
your new configuration.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ApplicationNotes.html" class="btn btn-neutral float-left" title="Application Notes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="FAQ.html" class="btn btn-neutral float-right" title="Frequently Asked Questions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023-2024, EM Microelectronic.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>