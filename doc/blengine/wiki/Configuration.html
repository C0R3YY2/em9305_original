

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Configuration &mdash; BLEngine 1.10.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=1d24b1d9"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/js/search.js?v=a5c8da7a"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="CLI Usage and options" href="Usage.html" />
    <link rel="prev" title="Getting Started" href="Getting-Started.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >

          
          
          <a href="../index.html">
            
              <img src="../_static/logo_h_small.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Getting-Started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#blengine-configuration-files">BLEngine Configuration files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration-structure">Configuration structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration-sections">Configuration Sections</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#device-specific-sections">Device Specific Sections</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nvm-configuration-section">NVM Configuration Section</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hci-protocol-configuration">HCI Protocol configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#logger-configuration">Logger configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#in-a-script-module">In a script module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Usage.html">CLI Usage and options</a></li>
<li class="toctree-l1"><a class="reference internal" href="Usage.html#blengine-commands">Blengine Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="Usage.html#python-module-usage">Python Module Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="NVM-Information.html">NVM Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="HCI-Device-API.html">HCI Device API</a></li>
<li class="toctree-l1"><a class="reference internal" href="Product-Lifecycle.html">Product Lifecycle</a></li>
<li class="toctree-l1"><a class="reference internal" href="Releases-Notes.html">Releases Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="howto/9304.html">9304 Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="howto/9305.html">9305 Examples</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../packets.html">HCI Packets List</a></li>
<li class="toctree-l1"><a class="reference internal" href="../procedures.html">BLEngine Procedures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/blengine.html">blengine package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: white" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">BLEngine</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Configuration</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="configuration">
<h1>Configuration<a class="headerlink" href="#configuration" title="Link to this heading"></a></h1>
<p>Interacting with external device may require an extended configuration system, so BLEngine tries to be simple.</p>
<p>A valid configuration file is needed to specify the devices connected to the host computer running <code class="docutils literal notranslate"><span class="pre">BLEngine</span></code>. This file also provides some application specific settings when relevant.</p>
<p>The engine handles a unique configuration object even if there are be more than one configuration file. At the end, all these configurations files are loaded and merged together. The values defined in the last opened configuration file take precedence and overwrite the previously defined ones.</p>
<section id="blengine-configuration-files">
<h2>BLEngine Configuration files<a class="headerlink" href="#blengine-configuration-files" title="Link to this heading"></a></h2>
<p>By default BLEngine will search for a <code class="docutils literal notranslate"><span class="pre">config.cfg</span></code> file in the following directories in the order given below. It will stop searching on the first match.</p>
<ol class="arabic simple">
<li><p>Current working Directory</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">./config</span></code> folder within the current directory</p></li>
<li><p>In the directory designated by the <code class="docutils literal notranslate"><span class="pre">BLENGINE_CONFIG_PATH</span></code> environnment variable</p></li>
<li><p>User Home Directory</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">./config</span></code> folder within the user home directory</p></li>
<li><p>In the current executed script/executable folder location</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">./config</span></code> folder within the current executed script/executable folder location</p></li>
<li><p>a config folder relative to the actual blengine python package installation (pip use case)</p></li>
</ol>
<p>You can also override the search by specifying the absolute path (or relative path to the current working directrory) on the command line with the <code class="docutils literal notranslate"><span class="pre">--config</span> <span class="pre">&lt;path&gt;</span></code> option.</p>
<p>For a given configuration file found and loaded, BLEngine will search in the same directory for a similarly named file with the <code class="docutils literal notranslate"><span class="pre">_local</span></code> suffix (i.e. <code class="docutils literal notranslate"><span class="pre">config_local.cfg</span></code>). If one is found, it will be merged after having loaded the original configuration file <code class="docutils literal notranslate"><span class="pre">config.cfg</span></code> allowing overwriting sections values.
The <code class="docutils literal notranslate"><span class="pre">config_local.cfg</span></code> file allows an end user to refine its own configuration without changing any value defined in the default configuration.
However, it has to be mentioned that this local configuration file is not provided in the SDK and has to be created by the end user if needed.
For that, it can be created by getting inspired from the default original <code class="docutils literal notranslate"><span class="pre">config.cfg</span></code> file that contains extensive documentation about each entry.</p>
</section>
<section id="configuration-structure">
<h2>Configuration structure<a class="headerlink" href="#configuration-structure" title="Link to this heading"></a></h2>
<p>The configuration system use the <code class="docutils literal notranslate"><span class="pre">configobj</span></code> module, which is basically an INI file manager on steroids. See the more details here:</p>
<p>(Configobj on ReadTheDocs)[https://configobj.readthedocs.io/en/latest/configobj.html#config-files]</p>
<p>The configuration file is obviously an INI file with subsections support and comments with <code class="docutils literal notranslate"><span class="pre">#comment</span></code>.</p>
</section>
<section id="configuration-sections">
<h2>Configuration Sections<a class="headerlink" href="#configuration-sections" title="Link to this heading"></a></h2>
<section id="device-specific-sections">
<h3>Device Specific Sections<a class="headerlink" href="#device-specific-sections" title="Link to this heading"></a></h3>
<p>Those sections are used to describe all the devices that can be used by the application.
Since there might be more than one device connected to the host computer, several devices sections can be defined by assigning them a friendly name that will be easier to use, one device section per one serial connection. As many device sections as needed can be created.</p>
<p>The only required parameter being just the port parameter which will be different than the one in the other device section.
The section’s name specifies the device name to be directly used by the application either by CLI or in scripts.</p>
<p>There is a default device section which name is <code class="docutils literal notranslate"><span class="pre">default_device</span></code>. This is the configuration
that is applied in case no specific device is provided when running the application.</p>
<p>A section can be merged or included in others section with the <code class="docutils literal notranslate"><span class="pre">include_section</span></code> special keyword.</p>
<p>The following example shows a section that defines the default serial parameters.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[default_serial_config]</span>
<span class="na">baudrate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">115200</span><span class="w"> </span><span class="c1"># optional, default value</span>
<span class="na">rtscts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="c1"># optional, default value</span>
<span class="na">flowCtrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="c1"># optional, default value</span>
<span class="na">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">0.1</span><span class="w"> </span><span class="c1"># optional, default value</span>
<span class="na">device_model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">EM9305</span><span class="w"> </span><span class="c1"># optional, default value</span>
</pre></div>
</div>
<p>Then, the section below shows how a device is defined. Some specific parameters are provided
like the port to use to communicate with the device. But for what concern the serial configuration, the above mentioned section is simply included.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[9305DVKBOARD-01]</span>
<span class="na">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">COM4</span><span class="w"> </span><span class="c1">#required anyway or taken from --port CLI option</span>
<span class="c1"># Serial port identifier (COM## on windows and /dev/tty### on linux)</span>
<span class="na">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">COM22</span>
<span class="c1"># Device require HCI authentication</span>
<span class="na">authentication</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
<span class="c1"># include default serial configuration section</span>
<span class="na">include_section</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">default_serial_config</span>
</pre></div>
</div>
<p>It is possible to override an already defined section parameter by creating a user custom configuration <code class="docutils literal notranslate"><span class="pre">config_local.cfg</span></code> file in which the already defined section is redefined. Then, all parameters given underneath this section will override the same parameters defined into the <code class="docutils literal notranslate"><span class="pre">config.cfg</span></code> file.</p>
<p>In the following <code class="docutils literal notranslate"><span class="pre">config_local.cfg</span></code> example, the communication port is overriden to be COM34 instead of COM22 as previously defined above.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[9305DVKBOARD-01]</span>
<span class="na">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">COM34</span><span class="w"> </span><span class="c1"># this will change the device port to COM34</span>
</pre></div>
</div>
<p><strong>You will likely need to update your config file to match your system requirements and devices connected before using BLEngine.</strong></p>
</section>
<section id="nvm-configuration-section">
<h3>NVM Configuration Section<a class="headerlink" href="#nvm-configuration-section" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">nvm_infos</span></code> section block specifies a list of folder paths that contain information page description files, separated by comma’s.</p>
<p>These paths are relative to the configuration file self location. Each json file in those sub-folders will then be recursively parsed.</p>
<p><strong>Experimental</strong> The <code class="docutils literal notranslate"><span class="pre">from_repo</span></code> key specify a repository to download like in the example below (commented line):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">nvm_infos</span><span class="p">]</span>
<span class="n">json_folders</span> <span class="o">=</span> <span class="o">./</span><span class="n">nvm_infos</span><span class="o">/</span>

<span class="c1">#from_repo = https://its-ado.swatchgroup.net/EMMarinProjects/T9305/_git/T9305_Config</span>
</pre></div>
</div>
<p>Here, the <code class="docutils literal notranslate"><span class="pre">./nvm_infos/</span></code> relative path will be used to read from/write to information pages.</p>
</section>
<section id="hci-protocol-configuration">
<h3>HCI Protocol configuration<a class="headerlink" href="#hci-protocol-configuration" title="Link to this heading"></a></h3>
<p>Options for changing protocol timeouts:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">HCIPacketProtocol</span><span class="p">]</span>
<span class="c1"># timeout in seconds before the protocol give up on a command response</span>
<span class="n">ack_timeout</span> <span class="o">=</span> <span class="mi">5</span>
<span class="c1"># Timeout in seconds for packet read (increase it in case of huge packets payload)</span>
<span class="n">read_timeout</span> <span class="o">=</span> <span class="mi">1</span>

</pre></div>
</div>
</section>
<section id="logger-configuration">
<h3>Logger configuration<a class="headerlink" href="#logger-configuration" title="Link to this heading"></a></h3>
<p>This section block is used to control how information are logged by the engine.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[logger]
# name of the default top level logger
name = blengine
# level of the default logger
level = DEBUG
# specify file logging level and filename, leave emnpty to disable it
log2file = DEBUG
log2file_path = ./logs/blengine

# log to the standard output, specify level or leave empty to disable it
log2screen = INFO

[[handlers]]
    [[[default]]]
        level = DEBUG
        formatter = standard
        class = logging.StreamHandler
        stream = ext://sys.stdout
</pre></div>
</div>
</section>
</section>
<section id="in-a-script-module">
<h2>In a script module<a class="headerlink" href="#in-a-script-module" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">blengine.core.config</span></code> package contains helpers to autoload your configuration inside a script. The example below shows how to proceed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">blengine.core</span> <span class="kn">import</span> <span class="n">config</span>

<span class="c1"># load a configuration file and merge it</span>
<span class="n">config</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;myconfig.cfg&quot;</span><span class="p">)</span>

<span class="c1"># merge dictionary with the current config object</span>
<span class="n">config_dict</span> <span class="o">=</span> <span class="p">{</span> 
  <span class="s2">&quot;9305&quot;</span><span class="p">:</span> <span class="s2">&quot;super&quot;</span>
<span class="p">}</span>

<span class="n">config</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">config_dict</span><span class="p">)</span>
</pre></div>
</div>
<p>To access the global config object, get the <code class="docutils literal notranslate"><span class="pre">config</span></code> attribute of the <code class="docutils literal notranslate"><span class="pre">config</span></code> module :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">blengine.core</span> <span class="kn">import</span> <span class="n">config</span>
<span class="c1"># or , to work directly with the global config</span>
<span class="c1"># from blengine.core.config import config</span>

<span class="n">global_config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">config</span>

<span class="c1"># get a sub-section</span>

<span class="n">subconfig</span> <span class="o">=</span> <span class="n">global_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;my_section&quot;</span><span class="p">)</span>

<span class="c1"># merge something with a sub section</span>

<span class="n">config_dict</span> <span class="o">=</span> <span class="p">{</span> 
  <span class="s2">&quot;9305&quot;</span><span class="p">:</span> <span class="s2">&quot;super&quot;</span>
<span class="p">}</span>

<span class="n">config</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">config_dict</span><span class="p">,</span> <span class="n">subconfig</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Getting-Started.html" class="btn btn-neutral float-left" title="Getting Started" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Usage.html" class="btn btn-neutral float-right" title="CLI Usage and options" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, EM Microelectronic.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>